# Python MCAP ROS2 support fast

This package provides fast ROS2 support for the Python MCAP file format reader.
It has no dependencies on ROS2 itself or a ROS2 environment, and can be used in any Python project.

## Benchmarks

Full benchmark suite comparing against reference mcap-ros2 implementation:

### Read Performance

```txt
------------------------------------------------------------------------------------------- benchmark 'msgs-10': 2 tests ------------------------------------------------------------------------------------------
Name (time in ms)                                  Min                 Max                Mean             StdDev              Median                IQR            Outliers      OPS            Rounds  Iterations
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark_decoder[mcap_ros2_fast-10]      21.5718 (1.0)       38.7162 (1.0)       23.0987 (1.0)       4.0369 (1.0)       22.1845 (1.0)       0.5779 (1.0)           1;1  43.2924 (1.0)          17           1
test_benchmark_decoder[mcap_ros2-10]          350.9862 (16.27)    393.1516 (10.15)    371.3217 (16.08)    20.6323 (5.11)     369.9486 (16.68)    40.7430 (70.50)         1;0   2.6931 (0.06)          5           1
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

---------------------------------------------------------------------------------------------- benchmark 'msgs-100': 2 tests -----------------------------------------------------------------------------------------------
Name (time in ms)                                     Min                   Max                  Mean             StdDev                Median                IQR            Outliers      OPS            Rounds  Iterations
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark_decoder[mcap_ros2_fast-100]        52.2543 (1.0)         59.4243 (1.0)         56.0681 (1.0)       2.8550 (1.0)         58.0115 (1.0)       5.2515 (1.0)           6;0  17.8355 (1.0)          17           1
test_benchmark_decoder[mcap_ros2-100]          1,328.4640 (25.42)    1,357.9154 (22.85)    1,344.8277 (23.99)    12.1982 (4.27)     1,346.7234 (23.21)    20.4214 (3.89)          2;0   0.7436 (0.04)          5           1
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------- benchmark 'msgs-1000': 2 tests ----------------------------------------------------------------------------------------------
Name (time in ms)                                      Min                   Max                  Mean             StdDev                Median                 IQR            Outliers     OPS            Rounds  Iterations
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark_decoder[mcap_ros2_fast-1000]       145.7657 (1.0)        152.7631 (1.0)        150.8727 (1.0)       2.3289 (1.0)        151.4528 (1.0)        0.9751 (1.0)           1;1  6.6281 (1.0)           7           1
test_benchmark_decoder[mcap_ros2-1000]          4,036.7147 (27.69)    4,223.1586 (27.65)    4,140.3328 (27.44)    72.2689 (31.03)    4,127.2564 (27.25)    100.1700 (102.73)        2;0  0.2415 (0.04)          5           1
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

**Read Summary:** mcap-ros2-support-fast is **16-27x faster** for reading/decoding.

### Write Performance

```txt
--------------------------------------------------------------------------------------------------- benchmark 'write-msgs-100': 2 tests ---------------------------------------------------------------------------------------------------
Name (time in ms)                                                   Min                   Max                  Mean              StdDev                Median                 IQR            Outliers     OPS            Rounds  Iterations
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark_read_and_write[mcap_ros2_fast_writer-100]       197.2528 (1.0)        221.3234 (1.0)        210.7595 (1.0)       11.7771 (1.0)        217.2403 (1.0)       21.4799 (1.0)           2;0  4.7447 (1.0)           5           1
test_benchmark_read_and_write[mcap_ros2_writer-100]          3,066.2734 (15.54)    3,499.7775 (15.81)    3,347.1933 (15.88)    169.7273 (14.41)    3,384.6481 (15.58)    200.2257 (9.32)          1;0  0.2988 (0.06)          5           1
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------- benchmark 'write-msgs-1000': 2 tests -----------------------------------------------------------------------------------------------------
Name (time in ms)                                                     Min                    Max                   Mean              StdDev                 Median                 IQR            Outliers     OPS            Rounds  Iterations
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_benchmark_read_and_write[mcap_ros2_fast_writer-1000]        619.5720 (1.0)         720.2718 (1.0)         660.8163 (1.0)       38.9177 (1.0)         653.0963 (1.0)       53.3909 (1.0)           2;0  1.5133 (1.0)           5           1
test_benchmark_read_and_write[mcap_ros2_writer-1000]          10,211.0985 (16.48)    10,796.5669 (14.99)    10,521.9311 (15.92)    261.1913 (6.71)     10,624.6813 (16.27)    461.1340 (8.64)          2;0  0.0950 (0.06)          5           1
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

**Write Summary:** mcap-ros2-support-fast is **15-16x faster** for writing/encoding.

## Performance Summary

- **Read/Decode:** 16-27x faster than reference mcap-ros2
- **Write/Encode:** 15-16x faster than reference mcap-ros2

Based on <https://github.com/foxglove/mcap/tree/main/python> (MIT licensed)
