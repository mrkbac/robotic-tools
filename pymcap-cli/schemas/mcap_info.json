{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "McapInfoOutput",
  "description": "Complete MCAP info output structure.",
  "type": "object",
  "required": [
    "file",
    "header",
    "statistics",
    "chunks",
    "channels",
    "schemas",
    "message_distribution"
  ],
  "properties": {
    "file": {
      "$ref": "#/definitions/FileInfo"
    },
    "header": {
      "$ref": "#/definitions/HeaderInfo"
    },
    "statistics": {
      "$ref": "#/definitions/StatisticsInfo"
    },
    "chunks": {
      "$ref": "#/definitions/ChunksInfo"
    },
    "channels": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ChannelInfo"
      }
    },
    "schemas": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SchemaInfo"
      }
    },
    "message_distribution": {
      "$ref": "#/definitions/MessageDistribution"
    }
  },
  "definitions": {
    "FileInfo": {
      "title": "FileInfo",
      "description": "File metadata.",
      "type": "object",
      "required": [
        "path",
        "size_bytes"
      ],
      "properties": {
        "path": {
          "type": "string"
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "HeaderInfo": {
      "title": "HeaderInfo",
      "description": "MCAP header information.",
      "type": "object",
      "required": [
        "library",
        "profile"
      ],
      "properties": {
        "library": {
          "type": "string"
        },
        "profile": {
          "type": "string"
        }
      }
    },
    "StatisticsInfo": {
      "title": "StatisticsInfo",
      "description": "MCAP statistics.",
      "type": "object",
      "required": [
        "message_count",
        "chunk_count",
        "channel_count",
        "attachment_count",
        "metadata_count",
        "message_start_time",
        "message_end_time",
        "duration_ns"
      ],
      "properties": {
        "message_count": {
          "type": "integer",
          "minimum": 0
        },
        "chunk_count": {
          "type": "integer",
          "minimum": 0
        },
        "message_index_count": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 0
        },
        "channel_count": {
          "type": "integer",
          "minimum": 0
        },
        "attachment_count": {
          "type": "integer",
          "minimum": 0
        },
        "metadata_count": {
          "type": "integer",
          "minimum": 0
        },
        "message_start_time": {
          "type": "integer",
          "minimum": 0
        },
        "message_end_time": {
          "type": "integer",
          "minimum": 0
        },
        "duration_ns": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "Stats": {
      "title": "Stats",
      "description": "Statistics with minimum, average, and maximum values.",
      "type": "object",
      "required": [
        "minimum",
        "maximum",
        "average",
        "median"
      ],
      "properties": {
        "minimum": {
          "type": "number",
          "minimum": 0
        },
        "maximum": {
          "type": "number",
          "minimum": 0
        },
        "average": {
          "type": "number",
          "minimum": 0
        },
        "median": {
          "type": "number",
          "minimum": 0
        }
      }
    },
    "PartialStats": {
      "title": "PartialStats",
      "description": "Statistics where only average is always available; min/max/median are only available in rebuild mode.",
      "type": "object",
      "required": [
        "average"
      ],
      "properties": {
        "average": {
          "type": "number",
          "minimum": 0
        },
        "minimum": {
          "type": [
            "number",
            "null"
          ],
          "minimum": 0
        },
        "maximum": {
          "type": [
            "number",
            "null"
          ],
          "minimum": 0
        },
        "median": {
          "type": [
            "number",
            "null"
          ],
          "minimum": 0
        }
      }
    },
    "CompressionStats": {
      "title": "CompressionStats",
      "description": "Statistics for a specific compression type.",
      "type": "object",
      "required": [
        "count",
        "compressed_size",
        "uncompressed_size",
        "compression_ratio",
        "message_count",
        "size_stats",
        "duration_stats"
      ],
      "properties": {
        "count": {
          "type": "integer",
          "minimum": 0
        },
        "compressed_size": {
          "type": "integer",
          "minimum": 0
        },
        "uncompressed_size": {
          "type": "integer",
          "minimum": 0
        },
        "compression_ratio": {
          "type": "number",
          "minimum": 0
        },
        "message_count": {
          "type": "integer",
          "minimum": 0
        },
        "size_stats": {
          "$ref": "#/definitions/Stats"
        },
        "duration_stats": {
          "$ref": "#/definitions/Stats"
        }
      }
    },
    "ChunkOverlaps": {
      "title": "ChunkOverlaps",
      "description": "Chunk overlap information.",
      "type": "object",
      "required": [
        "max_concurrent",
        "max_concurrent_bytes"
      ],
      "properties": {
        "max_concurrent": {
          "type": "integer",
          "minimum": 0
        },
        "max_concurrent_bytes": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "ChunksInfo": {
      "title": "ChunksInfo",
      "description": "Chunk-related information.",
      "type": "object",
      "required": [
        "by_compression",
        "overlaps"
      ],
      "properties": {
        "by_compression": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/CompressionStats"
          }
        },
        "overlaps": {
          "$ref": "#/definitions/ChunkOverlaps"
        }
      }
    },
    "ChannelInfo": {
      "title": "ChannelInfo",
      "description": "Information about a channel.",
      "type": "object",
      "required": [
        "id",
        "topic",
        "schema_id",
        "message_count",
        "hz_stats",
        "message_distribution"
      ],
      "properties": {
        "id": {
          "type": "integer"
        },
        "topic": {
          "type": "string"
        },
        "schema_id": {
          "type": "integer"
        },
        "schema_name": {
          "type": [
            "string",
            "null"
          ]
        },
        "message_count": {
          "type": "integer",
          "minimum": 0
        },
        "size_bytes": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 0
        },
        "duration_ns": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 0
        },
        "hz_stats": {
          "$ref": "#/definitions/PartialStats"
        },
        "hz_channel": {
          "type": [
            "number",
            "null"
          ],
          "minimum": 0
        },
        "bytes_per_second_stats": {
          "anyOf": [
            {
              "$ref": "#/definitions/PartialStats"
            },
            {
              "type": "null"
            }
          ]
        },
        "bytes_per_message": {
          "type": [
            "number",
            "null"
          ],
          "minimum": 0
        },
        "message_distribution": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 0
          }
        },
        "message_start_time": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 0
        },
        "message_end_time": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 0
        }
      }
    },
    "SchemaInfo": {
      "title": "SchemaInfo",
      "description": "Information about a schema.",
      "type": "object",
      "required": [
        "id",
        "name"
      ],
      "properties": {
        "id": {
          "type": "integer"
        },
        "name": {
          "type": "string"
        }
      }
    },
    "MessageDistribution": {
      "title": "MessageDistribution",
      "description": "Message distribution across time buckets.",
      "type": "object",
      "required": [
        "bucket_count",
        "bucket_duration_ns",
        "message_counts",
        "max_count"
      ],
      "properties": {
        "bucket_count": {
          "type": "integer",
          "minimum": 0
        },
        "bucket_duration_ns": {
          "type": "integer",
          "minimum": 0
        },
        "message_counts": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 0
          }
        },
        "max_count": {
          "type": "integer",
          "minimum": 0
        }
      }
    }
  }
}
